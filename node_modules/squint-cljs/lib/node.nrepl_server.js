import { $APP, shadow$provide, $jscomp } from "./compiler.js";
import "./cljs.pprint.js";
import "./node.js";
import "./compiler.node.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$fs from"fs";import*as esm_import$net from"net";
var G9=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},H9=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},I9=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},J9=function(a){return console.debug($APP.Jp.g(" ",a))},hha=function(a){return function(b,c){b=$APP.jf(b);var d=$APP.fe.g(b,$APP.QH),e=$APP.fe.g(b,gha);c=$APP.Rh.j(c,"id",d);c=$APP.r(e)?$APP.Rh.j(c,"session",e):c;return a.g?a.g(b,c):a.call(null,b,c)}},jha=function(){var a=
iha;return function(b,c){b=$APP.Tm.j(b,K9,$APP.zi);return a.g?a.g(b,c):a.call(null,b,c)}},lha=function(){var a=kha();return function(b,c){J9($APP.F(["request",b]));return a.g?a.g(b,c):a.call(null,b,c)}},mha=function(a){return function(b,c){J9($APP.F(["response",c]));return a.g?a.g(b,c):a.call(null,b,c)}},kha=function(){var a=jha();return function(b,c){return a.g?a.g(b,c):a.call(null,b,c)}},L9=function(a){return $APP.Rh.j($APP.bi(new $APP.I(null,3,5,$APP.N,["major","minor","incremental"],null),$APP.wu.h(a.split("."))),
"version-string",a)},nha=function(a,b,c){if($APP.r(a))if(a=M9.h?M9.h(a):M9.call(null,a),$APP.r(a)){b=$APP.jf(b);var d=$APP.fe.g(b,$APP.n9),e=$APP.fe.g(b,$APP.g9),f=$APP.fe.g(b,$APP.p9);b=$APP.Qa;var k=$APP.li,l=$APP.P6;$APP.Qa=e;$APP.li=f;$APP.P6=d;try{var m=new $APP.Fa;d=$APP.Sa;e=$APP.Ta;$APP.Sa=!0;$APP.Ta=function(h){return m.append(h)};try{a.h?a.h(c):a.call(null,c)}finally{$APP.Ta=e,$APP.Sa=d}return $APP.t.h(m)}finally{$APP.P6=l,$APP.li=k,$APP.Qa=b}}else return J9($APP.F(["Pretty-Printing is only supported for cider.nrepl.pprint/pprint"])),
$APP.Ri.l($APP.F([c]));else return $APP.Ri.l($APP.F([c]))},oha=function(a){a=$APP.vu(a,new $APP.n(null,4,[$APP.Kp,$APP.Pp,$APP.lu,!0,$APP.$p,!0,$APP.Sp,!0],null),$APP.u(N9));var b=$APP.jf(a),c=$APP.fe.g(b,$APP.uu);a=$APP.fe.g(b,$APP.T);$APP.Jf(N9,b);b=$APP.Zj("(async function () {\n%s\n}) ()","%s",c);$APP.Jf(O9,a);return b},uha=function(a,b){var c=$APP.jf(a);$APP.fe.g(c,$APP.T);a=$APP.fe.g(c,pha);$APP.fe.g(c,$APP.$k);$APP.fe.g(c,qha);$APP.fe.g(c,rha);return Promise.resolve(a).then(oha).then(function(d){$APP.LH.l($APP.F(["About to eval:"]));
$APP.LH.l($APP.F([d]));return eval(d)}).then(function(d){d=new $APP.n(null,2,["ns",$APP.t.h($APP.u(O9)),"value",nha(sha.h(c),tha.h(c),d)],null);return b.g?b.g(c,d):b.call(null,c,d)}).catch(function(d){console.error(d);var e=$APP.PH.h($APP.pj(d));e=$APP.r(e)?e:d.message;$APP.r(e)&&(e=new $APP.n(null,1,["err",[$APP.t.h(e),"\n"].join("")],null),b.g?b.g(c,e):b.call(null,c,e));d=new $APP.n(null,2,["ex",$APP.t.h(d),"ns",$APP.t.h($APP.pr)],null);return b.g?b.g(c,d):b.call(null,c,d)}).finally(function(){var d=
new $APP.n(null,2,["ns",$APP.t.h($APP.u(O9)),"status",new $APP.I(null,1,5,$APP.N,["done"],null)],null);return b.g?b.g(c,d):b.call(null,c,d)})},P9=function(a){a=$APP.jf(a);$APP.fe.g(a,$APP.T);return null},iha=function(a,b){a=$APP.jf(a);var c=$APP.fe.g(a,K9),d=$APP.fe.g(Q9,c);if($APP.r(d))return d.g?d.g(a,b):d.call(null,a,b);console.warn($APP.Jp.g(" ",$APP.F(["Unhandled operation",c])));c=new $APP.n(null,1,["status",new $APP.I(null,3,5,$APP.N,["error","unknown-op","done"],null)],null);return b.g?b.g(a,
c):b.call(null,a,c)},vha=function(a){return function(b,c){return a.write(R9(c))}},wha=function(a,b){J9($APP.F(["Connection accepted"]));b.setNoDelay(!0);var c=lha(),d=hha(mha(vha(b))),e=$APP.Vi.h(null);b.on("data",function(f){var k=$APP.u(e);if($APP.r(k)){f=[$APP.t.h(k),$APP.t.h(f)].join("");$APP.Jf(e,null);var l=f}else l=f;a:for(f=$APP.F([$APP.xu,!0]),k=$APP.kg;;){var m=$APP.Gf.j(S9,l,f);l=$APP.B.j(m,0,null);m=$APP.B.j(m,1,null);if(null==l){k=new $APP.I(null,2,5,$APP.N,[k,m],null);break a}k=$APP.Ee.g(k,
l);l=m}f=$APP.B.j(k,0,null);k=$APP.B.j(k,1,null);$APP.gk(k)||$APP.Jf(e,k);f=$APP.x(f);k=null;for(var h=m=0;;)if(h<m)l=k.ba(null,h),c(l,d),h+=1;else if(f=$APP.x(f))k=f,$APP.Zd(k)?(f=$APP.uc(k),m=$APP.vc(k),k=f,l=$APP.xd(f),f=m,m=l):(l=$APP.y(k),c(l,d),f=$APP.z(k),k=null,m=0),h=0;else return null});return b.on("close",function(f){return $APP.r(f)?J9($APP.F(["Connection lost"])):J9($APP.F(["Connection closed"]))})},rha=new $APP.H(null,"_line","_line",232847719),tha=new $APP.H("nrepl.middleware.print",
"options","nrepl.middleware.print/options",868480159),gha=new $APP.H(null,"session","session",1008279103),xha=new $APP.H(null,"lookup","lookup",1225356838),yha=new $APP.H(null,"load-file","load-file",-424586670),qha=new $APP.H(null,"_load-file?","_load-file?",-1198848711),K9=new $APP.H(null,"op","op",-1882987955),zha=new $APP.H(null,"describe","describe",1369790582),pha=new $APP.H(null,"code","code",1586293142),Aha=new $APP.H(null,"eldoc","eldoc",-1321421900),Bha=new $APP.H(null,"log_level","log_level",
-1756736313),sha=new $APP.H("nrepl.middleware.print","print","nrepl.middleware.print/print",-1616742548),Cha=new $APP.H(null,"clone","clone",711747572),Dha=new $APP.H(null,"close","close",1835149582),Eha=new $APP.H(null,"info","info",-317069002),Fha=new $APP.H(null,"host","host",-1558485167),Gha=new $APP.H(null,"complete","complete",-500388775);var T9=function T9(a,b){switch($APP.t.h(I9(a,1))){case "i":return a=H9(a,1),b=G9(a,"e"),new $APP.I(null,2,5,$APP.N,[parseInt(I9(a,b)),H9(a,b+1)],null);case "l":var d=a=H9(a,1);for(a=$APP.mc($APP.kg);;){if($APP.A.g($APP.t.h(I9(d,1)),"e"))return new $APP.I(null,2,5,$APP.N,[$APP.oc(a),H9(d,1)],null);var e=T9.g?T9.g(d,b):T9.call(null,d,b),f=$APP.B.j(e,0,null),k=$APP.B.j(e,1,null);e=k;a=$APP.fg.g(a,f);d=e}case "d":for(a=H9(a,1),f=$APP.jf(b),f=$APP.fe.g(f,$APP.xu),d=a,e=$APP.mc($APP.hf);;){if($APP.A.g($APP.t.h(I9(d,
1)),"e"))return new $APP.I(null,2,5,$APP.N,[$APP.oc(e),H9(d,1)],null);a=T9.g?T9.g(d,b):T9.call(null,d,b);d=$APP.B.j(a,0,null);k=$APP.B.j(a,1,null);k=T9.g?T9.g(k,b):T9.call(null,k,b);a=$APP.B.j(k,0,null);k=$APP.B.j(k,1,null);d=$APP.r(f)?$APP.zi.h(d):d;a=$APP.Ug.j(e,d,a);d=k;e=a}default:return b=G9(a,":"),f=parseInt(I9(a,b)),a=H9(a,b+1),new $APP.I(null,2,5,$APP.N,[$APP.t.h(I9(a,f)),H9(a,f)],null)}},S9=function S9(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;return S9.l(arguments[0],
1<c.length?new $APP.Xc(c.slice(1),0,null):null)};S9.l=function(a,b){try{return T9(a,b)}catch(c){if(c instanceof Error)return new $APP.I(null,2,5,$APP.N,[null,a],null);throw c;}};S9.m=1;S9.o=function(a){var b=$APP.y(a);a=$APP.z(a);return this.l(b,a)};
var R9=function R9(a){for(;;){if("string"===typeof a)return[$APP.t.h(Buffer.from(a).length),":",a].join("");if(a instanceof $APP.H||a instanceof $APP.w)a=[function(){var c=$APP.Le(a);return $APP.r(c)?[c,"/"].join(""):null}(),$APP.ai(a)].join("");else return"number"===typeof a?["i",$APP.t.h(a),"e"].join(""):$APP.Td(a)||$APP.Xd(a)||null==a?["l",$APP.t.h($APP.Gf.g($APP.t,$APP.ui.g(R9,a))),"e"].join(""):$APP.Vd(a)?["d",$APP.t.h($APP.Gf.g($APP.t,$APP.ui.g(function(){return function(c){var d=$APP.B.j(c,
0,null);c=$APP.B.j(c,1,null);return[$APP.t.h(R9.h?R9.h(d):R9.call(null,d)),$APP.t.h(R9.h?R9.h(c):R9.call(null,c))].join("")}}(a),$APP.JH.g($APP.y,a)))),"e"].join(""):null}};var O9=$APP.Vi.h($APP.pr),M9=new $APP.n(null,1,["cider.nrepl.pprint/pprint",$APP.x9],null);$APP.Vi.h(!1);
var N9=$APP.Vi.h(null),Q9=$APP.vh([xha,Dha,yha,Aha,Cha,zha,Eha,Gha,$APP.RH],[P9,function(a,b){var c=new $APP.n(null,1,["status",new $APP.I(null,1,5,$APP.N,["done"],null)],null);return b.g?b.g(a,c):b.call(null,a,c)},function(a){a=$APP.jf(a);$APP.fe.g(a,$APP.$k);return null},P9,function(a,b){var c=new $APP.n(null,2,["new-session",$APP.t.h($APP.iH()),"status",new $APP.I(null,1,5,$APP.N,["done"],null)],null);return b.g?b.g(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.n(null,4,["versions",new $APP.n(null,
2,["nbb-nrepl",L9("TODO"),"node",L9(process.version)],null),"aux",$APP.hf,"ops",$APP.bi($APP.ui.g($APP.ai,$APP.Kh(Q9)),$APP.Lr.h($APP.hf)),"status",new $APP.I(null,1,5,$APP.N,["done"],null)],null);return b.g?b.g(a,c):b.call(null,a,c)},P9,function(){return null},function(a,b){a=$APP.jf(a);var c=$APP.fe.g(a,$APP.T);$APP.KH.l($APP.F([$APP.T,c]));return uha($APP.Rh.j(a,$APP.T,$APP.u(O9)),b)}]),Hha=$APP.Vi.h(null);export const startServer=function(a){return Promise.resolve(null).then(function(){var b=function(){var e=$APP.NH.h(a);return $APP.r(e)?e:0}(),c=function(){var e=Fha.h(a);return $APP.r(e)?e:"127.0.0.1"}();(function(){var e=$APP.$a(a)?a.bg:Bha.h(a);return $APP.r(e)?e:"info"})();var d=esm_import$net.createServer($APP.Tk.g(wha,$APP.hf));d.listen(b,c,function(){var e=d.address(),f=e.port;e=e.address;$APP.LH.l($APP.F([["nREPL server started on port ",$APP.t.h(f)," on host ",$APP.t.h(e)," - nrepl://",$APP.t.h(e),
":",$APP.t.h(f)].join("")]));try{return esm_import$fs.writeFileSync(".nrepl-port",$APP.t.h(f))}catch(k){return console.warn($APP.Jp.g(" ",$APP.F(["Could not write .nrepl-port",k])))}});return $APP.Jf(Hha,d)})};